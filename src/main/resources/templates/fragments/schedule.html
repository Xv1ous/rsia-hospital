<!-- Doctor Schedule Section Fragment -->
<section
  th:fragment="schedule"
  x-data="{ selectedSpec: 'semua', searchTerm: '' }"
  class="w-full py-8 sm:py-12 flex flex-col items-center px-4 max-w-6xl mx-auto mb-8 sm:mb-12"
>
  <h2
    class="text-2xl sm:text-3xl md:text-4xl font-bold text-[#E6521F] mb-2 text-center"
  >
    Jadwal Dokter
  </h2>
  <p
    class="text-base sm:text-lg text-[#E6521F] mb-6 sm:mb-8 font-medium text-center px-4"
  >
    Temukan Jadwal Praktik Dokter di Rumah Sakit Kami. Gunakan filter di bawah
    untuk mencari dokter atau spesialisasi.
  </p>
  <!-- Filter Dropdown - Mobile Friendly -->
  <div class="w-full mb-4">
    <select
      class="w-full sm:w-auto px-4 py-2 rounded-xl border-2 border-[#FF8000] text-[#E6521F] font-semibold shadow focus:ring-2 focus:ring-[#FF8000] transition"
      x-model="selectedSpec"
    >
      <option value="semua">Semua</option>
      <option
        th:each="spec : ${specializations}"
        th:value="${#strings.replace(#strings.toLowerCase(spec).trim(), ' ', '-')}"
        th:text="${spec}"
      ></option>
    </select>
  </div>
  <!-- Search Bar - Mobile Optimized -->
  <div class="w-full mb-6 flex flex-col sm:flex-row gap-3 items-center">
    <div class="relative w-full">
      <svg
        class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
        ></path>
      </svg>
      <input
        id="doctor-search"
        type="text"
        placeholder="Cari dokter atau spesialisasi..."
        class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-[#FF8000] focus:outline-none text-sm bg-white shadow-sm"
        x-model="searchTerm"
      />
    </div>
    <button
      id="clear-filters"
      type="button"
      class="w-full sm:w-auto px-6 py-3 rounded-xl bg-gray-100 text-gray-700 font-semibold hover:bg-gray-200 transition text-sm flex items-center justify-center gap-2"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"
        ></path>
      </svg>
    </button>
  </div>
  <!-- Desktop Table View -->
  <div
    class="w-full max-w-6xl mx-auto overflow-visible rounded-2xl shadow-lg bg-white p-4 sm:p-6 hidden md:block"
    style="min-height: 600px"
  >
    <div class="overflow-x-auto">
      <table
        class="min-w-full rounded-xl border border-gray-200 text-sm sm:text-base"
        id="doctor-schedule-table-desktop"
      >
        <thead>
          <tr class="bg-[#FF8000] text-white text-sm sm:text-base">
            <th class="py-3 sm:py-4 px-2 sm:px-4 text-left">Nama Dokter</th>
            <th class="py-3 sm:py-4 px-2 sm:px-4 text-left">Spesialisasi</th>
            <th class="py-3 sm:py-4 px-2 sm:px-4 text-left">Jadwal Praktik</th>
            <th class="py-3 sm:py-4 px-2 sm:px-4 text-left">Profil</th>
          </tr>
        </thead>
        <tbody>
          <tr
            th:each="doctor : ${doctors}"
            th:attr="data-slug=${#strings.replace(#strings.toLowerCase(doctor.specialization).trim(), ' ', '-')}, data-spec=${doctor.specialization}, data-name=${doctor.name}"
            class="group border-b hover:bg-[#FFF6E9] transition doctor-row"
          >
            <td
              class="py-3 sm:py-4 px-2 sm:px-4 font-extrabold text-base sm:text-lg text-[#FF8000]"
              th:text="${doctor.name}"
            ></td>
            <td class="py-3 sm:py-4 px-2 sm:px-4">
              <div class="flex flex-col gap-1">
                <span
                  th:text="${doctor.specialization}"
                  class="text-sm sm:text-base"
                ></span>
                <!-- Doctor Leave Status -->
                <div
                  th:if="${doctor.isOnLeave != null and doctor.isOnLeave}"
                  class="flex items-center gap-1"
                >
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                    </svg>
                    Cuti
                  </span>
                  <span
                    th:if="${doctor.leaveReason != null and doctor.leaveReason != ''}"
                    class="text-xs text-gray-500"
                    th:text="${'(' + doctor.leaveReason + ')'}"
                  ></span>
                </div>
              </div>
            </td>
            <td class="relative py-3 sm:py-4 px-2 sm:px-4">
              <div class="inline-block">
                <button
                  class="popover-btn px-3 sm:px-4 py-1 rounded-full bg-[#FF8000] text-white font-semibold shadow hover:bg-[#E6521F] transition text-xs"
                >
                  Lihat Jadwal
                </button>
                <div
                  class="popover-content hidden absolute left-1/2 -translate-x-1/2 top-full mt-2 z-50 bg-white border border-[#FF8000] rounded-xl shadow-xl p-3 sm:p-4 w-64 sm:w-72"
                >
                  <div
                    class="absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-l border-t border-[#FF8000] rotate-45"
                  ></div>
                  <button
                    class="absolute top-2 right-2 text-gray-400 hover:text-[#E6521F] text-lg font-bold close-popover"
                  >
                    &times;
                  </button>
                  <h3
                    class="text-sm sm:text-base font-bold text-[#FF8000] mb-3 text-center"
                    th:text="${doctor.name}"
                  ></h3>
                  <ul class="space-y-2">
                    <!-- Fallback if no schedules -->
                    <li
                      th:if="${scheduleMap == null or scheduleMap[doctor.name] == null or #lists.size(scheduleMap[doctor.name]) == 0}"
                      class="text-center py-2"
                    >
                      <span class="text-gray-500 text-sm"
                        >Belum ada jadwal tersedia</span
                      >
                    </li>

                    <!-- Actual schedule display -->
                    <li
                      th:if="${scheduleMap != null and scheduleMap[doctor.name] != null and #lists.size(scheduleMap[doctor.name]) > 0}"
                      th:each="jadwal : ${scheduleMap[doctor.name]}"
                      class="flex items-center gap-2 text-sm sm:text-base"
                    >
                      <span
                        class="font-semibold text-[#E6521F]"
                        th:text="${jadwal.day}"
                      ></span
                      >:
                      <span
                        class="text-gray-700"
                        th:text="${jadwal.time}"
                      ></span>
                    </li>
                  </ul>
                </div>
              </div>
            </td>
            <td class="py-3 sm:py-4 px-2 sm:px-4 text-center">
              <a
                th:href="@{'/doctor-profile/' + ${doctor.id}}"
                class="inline-block px-2 py-1 rounded-full bg-[#E6521F] text-white font-semibold hover:bg-[#FB9E3A] hover:text-[#E6521F] transition text-xs min-w-[70px] text-center whitespace-nowrap"
              >
                Profil
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!-- Mobile Card View - Enhanced -->
  <div
    class="w-full max-w-6xl mx-auto space-y-4 md:hidden"
    id="doctor-schedule-cards-mobile"
    style="min-height: 800px"
  >
    <div
      th:each="doctor : ${doctors}"
      th:attr="data-slug=${#strings.replace(#strings.toLowerCase(doctor.specialization).trim(), ' ', '-')}, data-spec=${doctor.specialization}, data-name=${doctor.name}"
      class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden transition-all duration-200 hover:shadow-xl"
    >
      <!-- Doctor Header with Avatar -->
      <div class="p-4 border-b border-gray-50">
        <div class="flex items-center gap-3">
          <div class="flex-1 min-w-0">
            <h3
              class="font-bold text-lg text-gray-900 mb-1 truncate"
              th:text="${doctor.name}"
            ></h3>
            <div class="flex items-center gap-2">
              <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800"
                th:text="${doctor.specialization}"
              ></span>
              <!-- Doctor Leave Status Mobile -->
              <div
                th:if="${doctor.isOnLeave != null and doctor.isOnLeave}"
                class="flex items-center gap-1"
              >
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                  </svg>
                  Cuti
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Schedule Preview -->
      <div class="p-4">
        <div class="flex items-center justify-between mb-3">
          <h4 class="font-semibold text-gray-800 flex items-center gap-2">
            <svg
              class="w-4 h-4 text-[#FF8000]"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              ></path>
            </svg>
            Jadwal Praktik
          </h4>
          <span
            class="text-xs text-gray-500"
            th:if="${scheduleMap != null and scheduleMap[doctor.name] != null}"
            th:text="${#lists.size(scheduleMap[doctor.name])} + ' hari'"
          ></span>
          <span
            class="text-xs text-gray-500"
            th:if="${scheduleMap == null or scheduleMap[doctor.name] == null or #lists.size(scheduleMap[doctor.name]) == 0}"
            >0 hari</span
          >
        </div>

        <!-- Quick Schedule Preview -->
        <div class="flex flex-wrap gap-2 mb-4">
          <!-- Jadwal tersedia -->
          <div
            th:if="${scheduleMap != null and scheduleMap[doctor.name] != null and iterStat.index < 3}"
            th:each="jadwal, iterStat : ${scheduleMap[doctor.name]}"
            class="flex items-center gap-1.5 px-2 py-1 bg-orange-50 rounded-lg border border-orange-100"
          >
            <div class="w-2 h-2 bg-[#FF8000] rounded-full"></div>
            <span
              class="text-xs font-medium text-[#E6521F]"
              th:text="${#strings.substring(jadwal.day, 0, 3)}"
            ></span>
            <span class="text-xs text-gray-600" th:text="${jadwal.time}"></span>
          </div>

          <!-- Indikator jadwal lebih dari 3 -->
          <div
            th:if="${scheduleMap != null and scheduleMap[doctor.name] != null and #lists.size(scheduleMap[doctor.name]) > 3}"
            class="flex items-center gap-1.5 px-2 py-1 bg-gray-100 rounded-lg border border-gray-300"
          >
            <span class="text-xs text-gray-600">
              +<span
                th:text="${#lists.size(scheduleMap[doctor.name]) - 3}"
              ></span>
              lagi
            </span>
          </div>

          <!-- Fallback: Tidak ada jadwal -->
          <div
            th:unless="${scheduleMap != null and scheduleMap[doctor.name] != null and !scheduleMap[doctor.name].isEmpty()}"
            class="flex items-center gap-1.5 px-2 py-1 bg-gray-100 rounded-lg border border-gray-300"
          >
            <span class="text-xs text-gray-500">Jadwal belum tersedia</span>
          </div>
        </div>

        <!-- View Full Schedule Button -->
        <button
          class="w-full popover-btn-mobile px-4 py-3 rounded-xl bg-[#E6521F] text-white font-semibold shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2 group"
        >
          <svg
            class="w-4 h-4 group-hover:scale-110 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
            ></path>
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
            ></path>
          </svg>
          Lihat Jadwal Lengkap
        </button>

        <!-- Mobile Schedule Modal - Enhanced -->
        <div
          class="mobile-schedule-modal hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl w-full max-w-sm max-h-[85vh] overflow-hidden"
          >
            <!-- Modal Content -->
            <div class="p-4">
              <div class="grid grid-cols-2 gap-2 max-h-60 overflow-y-auto">
                <!-- Fallback if no schedules -->
                <div
                  th:if="${scheduleMap == null or scheduleMap[doctor.name] == null or #lists.size(scheduleMap[doctor.name]) == 0}"
                  class="text-center py-8"
                >
                  <p class="text-gray-500">Belum ada jadwal tersedia</p>
                </div>

                <!-- Actual schedule display -->
                <div
                  th:if="${scheduleMap != null and scheduleMap[doctor.name] != null and #lists.size(scheduleMap[doctor.name]) > 0}"
                  th:each="jadwal : ${scheduleMap[doctor.name]}"
                  class="flex items-center justify-between p-4 bg-gradient-to-r from-orange-50 to-red-50 rounded-xl border border-orange-100 hover:shadow-md transition-all duration-200"
                >
                  <div class="flex items-center gap-3">
                    <div>
                      <span
                        class="font-bold text-[#E6521F] text-base block"
                        th:text="${jadwal.day}"
                      ></span>
                      <span class="text-xs text-gray-500">Jadwal Praktik</span>
                    </div>
                  </div>
                  <div class="text-right">
                    <span class="text-xs" th:text="${jadwal.time}"></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modal Footer -->
            <div
              class="sticky bottom-0 bg-gray-50 p-4 border-t border-gray-200"
            >
              <div class="flex gap-3">
                <a
                  th:href="@{'/doctor-profile/' + ${doctor.id}}"
                  class="flex-1 py-3 bg-[#E6521F] text-white font-semibold rounded-xl hover:bg-[#FB9E3A] transition text-center flex items-center justify-center gap-2"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                    ></path>
                  </svg>
                  Lihat Profil
                </a>
                <button
                  class="flex-1 py-3 bg-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-300 transition close-mobile-modal"
                >
                  Tutup
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination Controls Desktop -->
  <div
    id="pagination-controls"
    class="w-full flex justify-center mt-8 mb-4 px-4 pt-4 hidden md:flex sticky bottom-0 bg-white py-2"
  ></div>

  <!-- Pagination Controls Mobile -->
  <div
    id="pagination-controls-mobile"
    class="w-full flex justify-center mt-8 mb-4 px-4 pt-4 md:hidden sticky bottom-0 bg-white py-2"
  ></div>

  <style>
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
  </style>
</section>

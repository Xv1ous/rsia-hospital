<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - RSIA Buah Hati</title>
    <link href="/main.css" rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-orange: #e6521f;
        --primary-orange-light: #ffede6;
        --primary-orange-dark: #b13a17;
      }
      .text-primary-orange {
        color: var(--primary-orange) !important;
      }
      .bg-primary-orange {
        background-color: var(--primary-orange) !important;
      }
      .bg-primary-orange-light {
        background-color: var(--primary-orange-light) !important;
      }
      .bg-primary-orange-dark {
        background-color: var(--primary-orange-dark) !important;
      }
      .font-sans {
        font-family: "Inter", "Segoe UI", "Roboto", "Helvetica Neue", Arial,
          "sans-serif";
      }

      /* Modal scrolling improvements */
      .modal-scroll {
        scrollbar-width: thin;
        scrollbar-color: #cbd5e0 #f7fafc;
      }

      .modal-scroll::-webkit-scrollbar {
        width: 6px;
      }

      .modal-scroll::-webkit-scrollbar-track {
        background: #f7fafc;
        border-radius: 3px;
      }

      .modal-scroll::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 3px;
      }

      .modal-scroll::-webkit-scrollbar-thumb:hover {
        background: #a0aec0;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-900 font-sans">
    <!-- CSRF Token -->
    <input type="hidden" name="_csrf" th:value="${_csrf.token}" />

    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <aside
        class="w-64 bg-[#E6521F] text-white flex-col py-8 px-4 hidden md:flex"
      >
        <div class="text-2xl font-bold mb-8 flex items-center gap-2">
          <img
            src="/asset hospital/RSIA_BHP_LOGO5.png"
            alt="Logo"
            class="h-10 w-10 bg-white rounded-full p-1"
          />
          Admin Panel
        </div>
        <nav class="flex flex-col gap-4 mt-4">
          <a href="#dashboard" class="hover:text-[#FF8000] font-semibold"
            >Dashboard</a
          >
          <a href="#appointments" class="hover:text-[#FF8000]">Janji Temu</a>
          <a href="#doctors" class="hover:text-[#FF8000]">Dokter</a>
        </nav>
        <div class="mt-auto pt-8">
          <a
            href="/"
            class="block text-center px-4 py-2 rounded bg-white text-[#E6521F] font-semibold hover:bg-[#FF8000] hover:text-white transition"
            >Kembali ke Beranda</a
          >
        </div>
      </aside>
      <!-- Main Content -->
      <div class="flex-1 flex flex-col">
        <!-- Topbar -->
        <header
          class="bg-[#E6521F] shadow px-4 py-4 flex items-center justify-between sticky top-0 z-10"
        >
          <nav aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2 text-sm text-white">
              <li><a href="/" class="hover:underline">Beranda</a></li>
              <li><span class="mx-2">/</span></li>
              <li class="font-semibold">Admin Panel</li>
            </ol>
          </nav>
          <div class="flex items-center gap-4">
            <span class="font-semibold text-white">Admin</span>
            <img
              src="/asset hospital/RSIA_BHP_LOGO5.png"
              alt="Admin Avatar"
              class="h-8 w-8 rounded-full border-2 border-white"
            />
          </div>
        </header>
        <!-- Dashboard Overview Cards -->
        <section class="grid grid-cols-2 gap-6 mb-8">
          <div
            class="bg-primary-orange-light rounded-xl shadow p-6 flex flex-col items-center"
          >
            <div
              class="text-3xl font-bold text-primary-orange mb-2"
              th:text="${appointments.size()}"
            ></div>
            <div class="text-[#E6521F] font-semibold">Janji Temu</div>
          </div>
          <div
            class="bg-primary-orange-light rounded-xl shadow p-6 flex flex-col items-center"
          >
            <div
              class="text-3xl font-bold text-primary-orange mb-2"
              th:text="${doctors.size()}"
            ></div>
            <div class="text-[#17695b] font-semibold">Dokter Aktif</div>
          </div>
        </section>
        <!-- Appointments Table -->
        <section id="appointments" class="p-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold text-[#17695b]">
              Manajemen Janji Temu
            </h2>
            <button
              id="open-add-appointment-modal"
              class="px-4 py-2 rounded bg-primary-orange text-white font-semibold hover:bg-primary-orange-dark transition"
            >
              + Tambah Janji
            </button>
          </div>
          <div class="overflow-x-auto rounded-xl shadow bg-white">
            <table class="min-w-full">
              <thead class="bg-[#E6521F] text-white">
                <tr>
                  <th class="py-3 px-4 text-left">Nama Pasien</th>
                  <th class="py-3 px-4 text-left">Dokter</th>
                  <th class="py-3 px-4 text-left">Tanggal</th>
                  <th class="py-3 px-4 text-left">Jam</th>
                  <th class="py-3 px-4 text-left">Status</th>
                  <th class="py-3 px-4 text-left">Aksi</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="appointment : ${appointments}">
                  <td
                    class="py-3 px-4"
                    th:text="${appointment.patientName}"
                  ></td>
                  <td class="py-3 px-4">
                    <span
                      th:each="doc : ${doctors}"
                      th:if="${doc.id} == ${appointment.doctorId}"
                      th:text="${doc.name + ' (' + doc.specialization + ')'}"
                    ></span>
                  </td>
                  <td
                    class="py-3 px-4"
                    th:text="${appointment.appointmentDate}"
                  ></td>
                  <td
                    class="py-3 px-4"
                    th:text="${appointment.appointmentTime}"
                  ></td>
                  <td class="py-3 px-4">
                    <span
                      th:if="${appointment.status == 'Terkonfirmasi'}"
                      class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-green-500 text-white"
                      >Terkonfirmasi</span
                    >
                    <span
                      th:if="${appointment.status == 'Menunggu'}"
                      class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-yellow-400 text-white"
                      >Menunggu</span
                    >
                    <span
                      th:if="${appointment.status == 'Selesai'}"
                      class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-blue-500 text-white"
                      >Selesai</span
                    >
                    <span
                      th:if="${appointment.status != 'Terkonfirmasi' and appointment.status != 'Menunggu' and appointment.status != 'Selesai'}"
                      class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-gray-300 text-gray-700"
                      th:text="${appointment.status}"
                    ></span>
                  </td>
                  <td class="py-3 px-4 flex gap-2">
                    <button
                      class="px-3 py-1 rounded bg-[#E6521F] text-white text-xs font-semibold hover:bg-[#FF8000]"
                    >
                      Edit
                    </button>
                    <button
                      class="px-3 py-1 rounded bg-red-500 text-white text-xs font-semibold hover:bg-red-600"
                    >
                      Hapus
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
        <!-- Doctors Management Table -->
        <section id="doctors" class="p-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold text-[#17695b]">Manajemen Dokter</h2>
            <div class="flex gap-2">
              <button
                id="bulk-actions-btn"
                class="px-4 py-2 rounded bg-gray-500 text-white font-semibold hover:bg-gray-600 transition hidden"
                disabled
              >
                Bulk Actions (<span id="selected-count">0</span>)
              </button>
              <button
                id="open-add-doctor-modal"
                class="px-4 py-2 rounded bg-primary-orange text-white font-semibold hover:bg-primary-orange-dark transition"
              >
                + Tambah Dokter
              </button>
            </div>
          </div>
          <div class="overflow-x-auto rounded-xl shadow bg-white">
            <table class="min-w-full">
              <thead class="bg-[#17695b] text-white">
                <tr>
                  <th class="py-3 px-4 text-left">
                    <input
                      type="checkbox"
                      id="select-all-doctors"
                      class="w-4 h-4 text-primary-orange bg-gray-100 border-gray-300 rounded focus:ring-primary-orange focus:ring-2"
                    />
                  </th>
                  <th class="py-3 px-4 text-left">Nama Dokter</th>
                  <th class="py-3 px-4 text-left">Spesialisasi</th>
                  <th class="py-3 px-4 text-left">Hari</th>
                  <th class="py-3 px-4 text-left">Jam</th>
                  <th class="py-3 px-4 text-left">Status</th>
                  <th class="py-3 px-4 text-left">Aksi</th>
                </tr>
              </thead>
              <tbody>
                <tr
                  th:each="doctor : ${doctorSchedules}"
                  th:if="${doctor != null and doctor.name != null and doctor.name != ''}"
                  class="hover:bg-gray-50"
                >
                  <td class="py-3 px-4">
                    <input
                      type="checkbox"
                      th:attr="data-id=${doctor.id}"
                      class="doctor-checkbox w-4 h-4 text-primary-orange bg-gray-100 border-gray-300 rounded focus:ring-primary-orange focus:ring-2"
                    />
                  </td>
                  <td class="py-3 px-4" th:text="${doctor.name}"></td>
                  <td class="py-3 px-4" th:text="${doctor.specialization}"></td>
                  <td class="py-3 px-4">-</td>
                  <td class="py-3 px-4">-</td>
                  <td class="py-3 px-4">
                    <!-- Status Cuti -->
                    <span
                      th:if="${doctor.isOnLeave == true}"
                      class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-red-500 text-white"
                    >
                      🏖️ Cuti
                    </span>
                    <span
                      th:if="${doctor.isOnLeave == false || doctor.isOnLeave == null}"
                      class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-green-500 text-white"
                    >
                      ✅ Aktif
                    </span>
                    <!-- Status Kunci -->
                    <span
                      th:if="${doctor.isLocked == true}"
                      class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-yellow-500 text-white ml-1"
                    >
                      🔒 Dikunci
                    </span>
                  </td>
                  <td class="py-3 px-4 flex gap-2">
                    <button
                      class="px-3 py-1 rounded bg-[#E6521F] text-white text-xs font-semibold hover:bg-[#FF8000]"
                      th:attr="id=${'edit-doctor-' + doctor.id},data-id=${doctor.id},data-name=${doctor.name},data-specialization=${doctor.specialization},data-max-patients-per-day=${doctor.maxPatientsPerDay},data-is-on-leave=${doctor.isOnLeave},data-leave-reason=${doctor.leaveReason},data-leave-start-date=${doctor.leaveStartDate},data-leave-end-date=${doctor.leaveEndDate},data-is-locked=${doctor.isLocked},data-lock-reason=${doctor.lockReason},data-lock-start-date=${doctor.lockStartDate},data-lock-end-date=${doctor.lockEndDate}"
                    >
                      Edit
                    </button>
                    <button
                      class="px-3 py-1 rounded bg-red-500 text-white text-xs font-semibold hover:bg-red-600"
                      th:attr="data-id=${doctor.id}"
                    >
                      Hapus
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="flex gap-2 mt-4 justify-center">
              <a
                th:if="${currentPage > 0}"
                th:href="@{'/admin'(page=${currentPage - 1})}"
                class="px-3 py-1 rounded bg-gray-200"
                >Sebelumnya</a
              >
              <span
                >Halaman <span th:text="${currentPage + 1}"></span> dari
                <span th:text="${totalPages}"></span
              ></span>
              <a
                th:if="${currentPage + 1 < totalPages}"
                th:href="@{'/admin'(page=${currentPage + 1})}"
                class="px-3 py-1 rounded bg-gray-200"
                >Selanjutnya</a
              >
            </div>
          </div>
        </section>
        <!-- Modal Tambah Janji Temu -->
        <div
          id="add-appointment-modal"
          class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 hidden p-4"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-left relative max-h-[90vh] overflow-y-auto modal-scroll"
          >
            <button
              onclick="document.getElementById('add-appointment-modal').classList.add('hidden')"
              class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-2xl font-bold z-10"
            >
              &times;
            </button>
            <h3 class="text-xl font-bold mb-4 text-[#17695b]">
              Tambah Janji Temu
            </h3>
            <form class="space-y-4">
              <label class="block"
                >Nama Pasien
                <input
                  type="text"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                />
              </label>
              <label class="block"
                >Dokter
                <select
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                >
                  <option
                    th:each="doc : ${doctors}"
                    th:value="${doc.name}"
                    th:text="${doc.name}"
                  ></option>
                </select>
              </label>
              <label class="block"
                >Tanggal
                <input
                  type="date"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                />
              </label>
              <label class="block"
                >Jam
                <input
                  type="time"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                />
              </label>
              <label class="block"
                >Status
                <select
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                >
                  <option>Terkonfirmasi</option>
                  <option>Menunggu</option>
                  <option>Selesai</option>
                </select>
              </label>
              <button
                type="submit"
                class="w-full px-4 py-2 rounded bg-primary-orange text-white font-semibold hover:bg-primary-orange-dark transition"
              >
                Simpan
              </button>
            </form>
          </div>
        </div>
        <!-- Modal Tambah Dokter -->
        <div
          id="add-doctor-modal"
          class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 hidden p-4"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-left relative max-h-[90vh] overflow-y-auto modal-scroll"
          >
            <button
              onclick="document.getElementById('add-doctor-modal').classList.add('hidden')"
              class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-2xl font-bold z-10"
            >
              &times;
            </button>
            <h3 class="text-xl font-bold mb-4 text-[#17695b]">Tambah Dokter</h3>
            <form class="space-y-4">
              <label class="block"
                >Nama Dokter
                <input
                  type="text"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                />
              </label>
              <label class="block"
                >Spesialisasi
                <select
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                >
                  <option
                    th:each="spec : ${specializations}"
                    th:value="${spec}"
                    th:text="${spec}"
                  ></option>
                </select>
              </label>
              <label class="block"
                >Jadwal
                <input
                  type="text"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                />
              </label>
              <button
                type="submit"
                class="w-full px-4 py-2 rounded bg-primary-orange text-white font-semibold hover:bg-primary-orange-dark transition"
              >
                Simpan
              </button>
            </form>
          </div>
        </div>
        <!-- Modal Tambah Berita -->
        <div
          id="add-news-modal"
          class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 hidden p-4"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-left relative max-h-[90vh] overflow-y-auto modal-scroll"
          >
            <button
              onclick="document.getElementById('add-news-modal').classList.add('hidden')"
              class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-2xl font-bold z-10"
            >
              &times;
            </button>
            <h3 class="text-xl font-bold mb-4 text-[#17695b]">Tambah Berita</h3>
            <form
              th:action="@{/admin/news}"
              method="post"
              enctype="multipart/form-data"
              class="space-y-4"
            >
              <label class="block"
                >Judul
                <input
                  type="text"
                  name="title"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                  required
                />
              </label>
              <label class="block"
                >Tanggal
                <input
                  type="date"
                  name="date"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                  required
                />
              </label>
              <label class="block"
                >Isi Artikel
                <textarea
                  name="content"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                  rows="5"
                  required
                ></textarea>
              </label>
              <label class="block"
                >Upload Gambar
                <input
                  type="file"
                  name="image"
                  accept="image/*"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                />
              </label>
              <label class="block"
                >Status
                <select
                  name="status"
                  class="w-full px-3 py-2 rounded border border-gray-200 mt-1"
                >
                  <option value="Publikasi">Publikasi</option>
                  <option value="Draft">Draft</option>
                </select>
              </label>
              <button
                type="submit"
                class="w-full px-4 py-2 rounded bg-primary-orange text-white font-semibold hover:bg-primary-orange-dark transition"
              >
                Simpan
              </button>
            </form>
          </div>
        </div>
        <!-- Modal (reusable for Edit/Hapus) -->
        <div
          id="admin-modal"
          class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 hidden p-4"
        >
          <div
            id="admin-modal-content"
            class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-left relative max-h-[90vh] overflow-y-auto modal-scroll"
          >
            <!-- Content will be injected by JS -->
          </div>
        </div>

        <!-- Modal Bulk Actions -->
        <div
          id="bulk-actions-modal"
          class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 hidden p-4"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-left relative max-h-[90vh] overflow-y-auto modal-scroll"
          >
            <button
              onclick="document.getElementById('bulk-actions-modal').classList.add('hidden')"
              class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-2xl font-bold z-10"
            >
              &times;
            </button>
            <h3 class="text-xl font-bold mb-4 text-[#17695b]">
              Bulk Actions (<span id="bulk-selected-count">0</span> doctors
              selected)
            </h3>
            <div class="space-y-4">
              <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <p class="text-yellow-800 text-sm">
                  <strong>Selected doctors:</strong>
                  <span id="bulk-selected-names" class="block mt-1"></span>
                </p>
              </div>
              <div class="space-y-3">
                <button
                  id="bulk-set-active"
                  class="w-full px-4 py-2 rounded bg-green-500 text-white font-semibold hover:bg-green-600 transition"
                >
                  🟢 Set Active
                </button>
                <button
                  id="bulk-set-on-leave"
                  class="w-full px-4 py-2 rounded bg-orange-500 text-white font-semibold hover:bg-orange-600 transition"
                >
                  🏖️ Set On Leave
                </button>
                <button
                  id="bulk-lock"
                  class="w-full px-4 py-2 rounded bg-yellow-500 text-white font-semibold hover:bg-yellow-600 transition"
                >
                  🔒 Lock Doctors
                </button>
                <button
                  id="bulk-delete"
                  class="w-full px-4 py-2 rounded bg-red-500 text-white font-semibold hover:bg-red-600 transition"
                >
                  🗑️ Delete Selected
                </button>
              </div>
            </div>
          </div>
        </div>
        <script src="/js/admin.js"></script>
      </div>
    </div>
  </body>
</html>

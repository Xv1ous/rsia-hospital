<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org">
  <!-- Head Fragment -->
  <head th:replace="~{fragments/head :: head}"></head>
  <body class="bg-gray-50 text-gray-900 font-sans">
    <script th:inline="javascript">
      document.title = "Buat Janji Temu Online - RSIA Buah Hati Pamulang";
    </script>
    <div th:replace="~{fragments/navbar :: navbar}"></div>
    <!-- Breadcrumb -->
    <nav class="max-w-lg mx-auto px-4 pt-6" aria-label="Breadcrumb">
      <ol class="flex items-center space-x-2 text-sm text-gray-500">
        <li><a href="/" class="hover:underline">Beranda</a></li>
        <li><span class="mx-2">/</span></li>
        <li class="text-primary-orange font-semibold">Janji Temu</li>
      </ol>
    </nav>
    <section
      class="min-h-screen flex flex-col items-center justify-center py-16 px-4 bg-white"
    >
      <div class="w-full max-w-4xl bg-[#eaf7f3] rounded-2xl shadow-xl p-8">
        <h1 class="text-3xl md:text-4xl font-bold text-[#E6521F] mb-4">
          Buat Janji Temu
        </h1>
        <div
          th:if="${success}"
          class="mb-4 p-4 rounded bg-green-100 text-green-800 border border-green-300 text-center font-semibold"
        >
          Permintaan janji temu berhasil dikirim! Kami akan segera menghubungi
          Anda.
        </div>
        <form
          th:action="@{/janji-temu}"
          method="post"
          th:object="${appointment}"
          class="bg-[#ffede6] rounded-xl shadow p-6 max-w-lg mx-auto mb-8"
        >
          <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />
          <div class="mb-4">
            <label class="block text-[#E6521F] font-semibold mb-1"
              >Nama Lengkap</label
            >
            <input
              type="text"
              name="patientName"
              th:field="*{patientName}"
              class="w-full px-4 py-2 rounded border border-[#E6521F] focus:ring-2 focus:ring-[#E6521F] focus:outline-none"
              required
            />
          </div>
          <div class="mb-4">
            <label class="block text-[#E6521F] font-semibold mb-1"
              >Nomor Telepon</label
            >
            <input
              type="text"
              name="patientPhone"
              th:field="*{patientPhone}"
              class="w-full px-4 py-2 rounded border border-[#E6521F] focus:ring-2 focus:ring-[#E6521F] focus:outline-none"
              required
            />
          </div>
          <div class="mb-4">
            <label class="block text-[#E6521F] font-semibold mb-1"
              >Dokter</label
            >
            <select
              name="doctorId"
              th:field="*{doctorId}"
              class="w-full px-4 py-2 rounded border border-[#E6521F] focus:ring-2 focus:ring-[#E6521F] focus:outline-none"
              required
            >
              <option value="">Pilih Dokter</option>
              <option
                th:each="doc : ${doctors}"
                th:value="${doc.id}"
                th:text="${doc.name + ' (' + doc.specialization + ')'}"
              ></option>
            </select>
          </div>
          <div class="mb-4">
            <label class="block text-[#E6521F] font-semibold mb-1"
              >Tanggal</label
            >
            <input
              type="date"
              name="appointmentDate"
              th:field="*{appointmentDate}"
              class="w-full px-4 py-2 rounded border border-[#E6521F] focus:ring-2 focus:ring-[#E6521F] focus:outline-none"
              required
            />
          </div>
          <div class="mb-4">
            <label class="block text-[#E6521F] font-semibold mb-1">Jam</label>
            <input
              type="time"
              name="appointmentTime"
              th:field="*{appointmentTime}"
              class="w-full px-4 py-2 rounded border border-[#E6521F] focus:ring-2 focus:ring-[#E6521F] focus:outline-none"
              required
            />
          </div>
          <div class="mb-4">
            <label class="block text-[#E6521F] font-semibold mb-1"
              >Catatan</label
            >
            <input
              type="text"
              name="notes"
              th:field="*{notes}"
              class="w-full px-4 py-2 rounded border border-[#E6521F] focus:ring-2 focus:ring-[#E6521F] focus:outline-none"
            />
          </div>
          <button
            type="button"
            onclick="kirimKeWhatsApp()"
            class="w-full px-4 py-2 rounded bg-green-500 text-white font-semibold shadow hover:bg-green-700 transition mt-2 flex items-center justify-center gap-2"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"
              />
            </svg>
            Kirim ke WhatsApp
          </button>
        </form>
        <a
          href="/"
          class="px-4 py-2 rounded bg-[#E6521F] text-white font-semibold shadow hover:bg-[#FF8000] transition text-sm"
          >Kembali ke Beranda</a
        >
      </div>
      <script>
        // Filter dokter sesuai departemen
        document.addEventListener("DOMContentLoaded", function () {
          const departemen = document.getElementById("departemen");
          const dokter = document.getElementById("dokter");
          departemen.addEventListener("change", function () {
            const value = this.value;
            Array.from(dokter.options).forEach((opt) => {
              if (!opt.value || !opt.dataset.departemen) {
                opt.style.display = "";
              } else {
                opt.style.display =
                  opt.dataset.departemen === value ? "" : "none";
              }
            });
            dokter.value = "";
          });
          // Form submit dummy
          document.getElementById("form-janji").onsubmit = function (e) {
            e.preventDefault();
            this.classList.add("hidden");
            document.getElementById("sukses-janji").classList.remove("hidden");
          };
        });
        // Kirim ke WhatsApp
        function kirimKeWhatsApp() {
          var nama = document.querySelector('[name="patientName"]').value;
          var telp = document.querySelector('[name="patientPhone"]').value;
          var dokter = document.querySelector('[name="doctorId"]');
          var dokterText = dokter.options[dokter.selectedIndex]
            ? dokter.options[dokter.selectedIndex].text
            : "";
          var spesialis = document.querySelector('[name="department"]').value;
          var tanggal = document.querySelector(
            '[name="appointmentDate"]'
          ).value;
          var jam = document.querySelector('[name="appointmentTime"]').value;
          var catatan = document.querySelector('[name="notes"]').value;
          var no_wa = "6287770065455";
          var pesan =
            `Halo Admin RSIA BHP, saya ingin membuat janji temu:\n\n` +
            `Nama: ${nama}\n` +
            `No. HP: ${telp}\n` +
            `Dokter: ${dokterText}\n` +
            `Spesialisasi: ${spesialis}\n` +
            `Tanggal: ${tanggal}\n` +
            `Jam: ${jam}\n` +
            `Catatan: ${catatan}`;
          var url_wa =
            "https://wa.me/" + no_wa + "?text=" + encodeURIComponent(pesan);
          window.open(url_wa, "_blank");
        }
      </script>
    </section>
  </body>
</html>
